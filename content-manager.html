<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Manager - Queer Latin Dance SD</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #f8f9fa;
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 80px;
            resize: vertical;
        }
        
        button {
            background: #667eea;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background: #5a67d8;
        }
        
        .delete-btn {
            background: #e53e3e;
        }
        
        .delete-btn:hover {
            background: #c53030;
        }
        
        .content-list {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        
        .content-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .content-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .content-item p {
            margin: 5px 0;
            color: #666;
        }
        
        .flyer-preview {
            max-width: 200px;
            max-height: 200px;
            object-fit: contain;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .instructions {
            background: #e6fffa;
            border: 1px solid #38b2ac;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .instructions h3 {
            color: #2c7a7b;
            margin-top: 0;
        }
        
        .export-section {
            text-align: center;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .lesson-specific {
            display: none;
        }
        
        .lesson-specific.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Content Manager</h1>
        
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('events')">ðŸ“… Events</button>
            <button class="tab-btn" onclick="switchTab('lessons')">ðŸŽ“ Lessons</button>
        </div>
        
        <!-- Events Tab -->
        <div id="events-tab" class="tab-content active">
            <div class="instructions">
                <h3>Managing Events:</h3>
                <p>Add upcoming events, workshops, and social gatherings. Events are automatically sorted by date.</p>
            </div>
            
            <div class="export-section">
                <button onclick="exportData('events')">ðŸ“¥ Export Events Data</button>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 14px;">Download and replace events-data.json</p>
            </div>
            
            <div class="form-section">
                <h2>Add New Event</h2>
                <form id="eventForm">
                    <div class="form-group">
                        <label for="eventTitle">Event Title:</label>
                        <input type="text" id="eventTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventDate">Event Date:</label>
                        <input type="date" id="eventDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventFlyerUrl">Flyer Image URL or Path:</label>
                        <input type="text" id="eventFlyerUrl" placeholder="e.g., images/eventpage/newflyer.png" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventDescription">Description (optional):</label>
                        <textarea id="eventDescription" placeholder="Brief description of the event"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="eventType">Event Status:</label>
                        <select id="eventType">
                            <option value="upcoming">Upcoming Event</option>
                            <option value="past">Past Event</option>
                        </select>
                    </div>
                    
                    <button type="submit">Add Event</button>
                </form>
            </div>
            
            <div class="content-list">
                <h2>Current Events</h2>
                <div id="eventsList"></div>
            </div>
        </div>
        
        <!-- Lessons Tab -->
        <div id="lessons-tab" class="tab-content">
            <div class="instructions">
                <h3>Managing Lessons:</h3>
                <p>Add lesson types, classes, and course offerings. Use "ongoing" for continuous classes or specific dates for scheduled courses.</p>
            </div>
            
            <div class="export-section">
                <button onclick="exportData('lessons')">ðŸ“¥ Export Lessons Data</button>
                <p style="margin: 10px 0 0 0; color: #666; font-size: 14px;">Download and replace lessons-data.json</p>
            </div>
            
            <div class="form-section">
                <h2>Add New Lesson</h2>
                <form id="lessonForm">
                    <div class="form-group">
                        <label for="lessonTitle">Lesson Title:</label>
                        <input type="text" id="lessonTitle" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonType">Lesson Type:</label>
                        <select id="lessonType" onchange="toggleLessonFields()">
                            <option value="dropin">Drop-in Class</option>
                            <option value="series">Series/Course</option>
                            <option value="private">Private Lesson</option>
                            <option value="online">Online Class</option>
                            <option value="workshop">Workshop</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonDate">Date (or "ongoing" for continuous classes):</label>
                        <input type="text" id="lessonDate" placeholder="2025-10-01 or 'ongoing'" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonMonth">Display Month (short):</label>
                        <input type="text" id="lessonMonth" placeholder="e.g., OCT, DROP, 4WK" maxlength="4" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonDay">Display Day/Number:</label>
                        <input type="text" id="lessonDay" placeholder="e.g., 15, IN, SER" maxlength="3">
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonFlyerUrl">Flyer Image URL or Path:</label>
                        <input type="text" id="lessonFlyerUrl" placeholder="e.g., images/lessons/newclass.png" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonDescription">Description:</label>
                        <textarea id="lessonDescription" placeholder="Description of the lesson" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonLink">Page Link:</label>
                        <input type="text" id="lessonLink" placeholder="e.g., dropin.html or leave empty for coming soon">
                    </div>
                    
                    <div class="form-group">
                        <label for="lessonStatus">Status:</label>
                        <select id="lessonStatus">
                            <option value="upcoming">Available Now</option>
                            <option value="coming_soon">Coming Soon</option>
                        </select>
                    </div>
                    
                    <button type="submit">Add Lesson</button>
                </form>
            </div>
            
            <div class="content-list">
                <h2>Current Lessons</h2>
                <div id="lessonsList"></div>
            </div>
        </div>
    </div>

    <script>
        // Data storage - will be loaded from JSON files
        let eventsData = {
            upcoming: [],
            past: []
        };

        let lessonsData = {
            upcoming: [],
            coming_soon: []
        };

        // Load existing data from JSON files
        async function loadData() {
            try {
                // Load events data
                const eventsResponse = await fetch('./events-data.json');
                if (eventsResponse.ok) {
                    eventsData = await eventsResponse.json();
                    console.log('Loaded events data:', eventsData);
                }
            } catch (error) {
                console.log('Could not load events data, using defaults:', error);
                // Fallback data if file doesn't exist
                eventsData = {
                    upcoming: [{
                        "id": "sep2025-banda",
                        "date": "2025-09-21",
                        "month": "SEP",
                        "day": "21",
                        "title": "Banda Workshop",
                        "flyerUrl": "images/eventpage/qsssepflyer.png",
                        "description": "Join us for an exciting banda workshop!"
                    }],
                    past: []
                };
            }

            try {
                // Load lessons data
                const lessonsResponse = await fetch('./lessons-data.json');
                if (lessonsResponse.ok) {
                    lessonsData = await lessonsResponse.json();
                    console.log('Loaded lessons data:', lessonsData);
                }
            } catch (error) {
                console.log('Could not load lessons data, using defaults:', error);
                // Fallback data if file doesn't exist
                lessonsData = {
                    upcoming: [{
                        "id": "dropin-intro",
                        "date": "ongoing",
                        "month": "DROP",
                        "day": "IN",
                        "title": "Intro to Salsa & Bachata",
                        "flyerUrl": "images/eventpage/4week1.png",
                        "description": "Drop-in classes for beginners",
                        "type": "dropin",
                        "link": "dropin.html"
                    }],
                    coming_soon: []
                };
            }

            // Display loaded data
            displayEvents();
            displayLessons();
        }

        // Tab switching
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
            
            // Refresh display
            if (tab === 'events') {
                displayEvents();
            } else {
                displayLessons();
            }
        }

        // Toggle lesson-specific fields
        function toggleLessonFields() {
            const lessonType = document.getElementById('lessonType').value;
            // Add any lesson-type specific logic here if needed
        }

        // Generate unique ID
        function generateId(title, date) {
            const cleanTitle = title.toLowerCase().replace(/[^a-z0-9]/g, '');
            const dateStr = date.replace(/-/g, '');
            return `${dateStr}-${cleanTitle}`.substring(0, 20);
        }

        // Get date parts for events
        function getDateParts(dateString) {
            if (dateString === 'ongoing' || dateString === 'tba') {
                return { month: 'TBA', day: '' };
            }
            const date = new Date(dateString);
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 
                          'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            return {
                month: months[date.getMonth()],
                day: date.getDate().toString()
            };
        }

        // Event form handler
        document.getElementById('eventForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const flyerUrl = document.getElementById('eventFlyerUrl').value;
            const description = document.getElementById('eventDescription').value;
            const eventType = document.getElementById('eventType').value;
            
            const dateParts = getDateParts(date);
            
            const newEvent = {
                id: generateId(title, date),
                date: date,
                month: dateParts.month,
                day: dateParts.day,
                title: title,
                flyerUrl: flyerUrl,
                description: description || ""
            };
            
            eventsData[eventType].push(newEvent);
            eventsData.upcoming.sort((a, b) => new Date(a.date) - new Date(b.date));
            eventsData.past.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('eventForm').reset();
            displayEvents();
            
            alert(`Event "${title}" added successfully!`);
        });

        // Lesson form handler
        document.getElementById('lessonForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('lessonTitle').value;
            const type = document.getElementById('lessonType').value;
            const date = document.getElementById('lessonDate').value;
            const month = document.getElementById('lessonMonth').value;
            const day = document.getElementById('lessonDay').value;
            const flyerUrl = document.getElementById('lessonFlyerUrl').value;
            const description = document.getElementById('lessonDescription').value;
            const link = document.getElementById('lessonLink').value;
            const status = document.getElementById('lessonStatus').value;
            
            const newLesson = {
                id: generateId(title, date),
                date: date,
                month: month.toUpperCase(),
                day: day.toUpperCase(),
                title: title,
                flyerUrl: flyerUrl,
                description: description,
                type: type,
                link: link || ""
            };
            
            lessonsData[status].push(newLesson);
            
            document.getElementById('lessonForm').reset();
            displayLessons();
            
            alert(`Lesson "${title}" added successfully!`);
        });

        // Display functions
        function displayEvents() {
            const eventsList = document.getElementById('eventsList');
            eventsList.innerHTML = '';
            
            if (eventsData.upcoming.length > 0) {
                eventsList.innerHTML += '<h3 style="color: #2d3748; margin-top: 20px;">Upcoming Events</h3>';
                eventsData.upcoming.forEach((event, index) => {
                    eventsList.innerHTML += createContentHTML(event, 'events', 'upcoming', index);
                });
            }
            
            if (eventsData.past.length > 0) {
                eventsList.innerHTML += '<h3 style="color: #2d3748; margin-top: 20px;">Past Events</h3>';
                eventsData.past.forEach((event, index) => {
                    eventsList.innerHTML += createContentHTML(event, 'events', 'past', index);
                });
            }
        }

        function displayLessons() {
            const lessonsList = document.getElementById('lessonsList');
            lessonsList.innerHTML = '';
            
            if (lessonsData.upcoming.length > 0) {
                lessonsList.innerHTML += '<h3 style="color: #2d3748; margin-top: 20px;">Available Lessons</h3>';
                lessonsData.upcoming.forEach((lesson, index) => {
                    lessonsList.innerHTML += createContentHTML(lesson, 'lessons', 'upcoming', index);
                });
            }
            
            if (lessonsData.coming_soon.length > 0) {
                lessonsList.innerHTML += '<h3 style="color: #2d3748; margin-top: 20px;">Coming Soon</h3>';
                lessonsData.coming_soon.forEach((lesson, index) => {
                    lessonsList.innerHTML += createContentHTML(lesson, 'lessons', 'coming_soon', index);
                });
            }
        }

        // Create content HTML
        function createContentHTML(item, contentType, category, index) {
            const extraFields = contentType === 'lessons' ? 
                `<p><strong>Type:</strong> ${item.type || 'N/A'}</p>
                 <p><strong>Link:</strong> ${item.link || 'N/A'}</p>` : '';
            
            return `
                <div class="content-item">
                    <h4>${item.title}</h4>
                    <p><strong>Date:</strong> ${item.date} (${item.month} ${item.day})</p>
                    <p><strong>Flyer:</strong> ${item.flyerUrl}</p>
                    ${item.description ? `<p><strong>Description:</strong> ${item.description}</p>` : ''}
                    ${extraFields}
                    <img src="${item.flyerUrl}" alt="${item.title}" class="flyer-preview" 
                         onerror="this.style.display='none'" onload="this.style.display='block'">
                    <br>
                    <button class="delete-btn" onclick="deleteContent('${contentType}', '${category}', ${index})">Delete</button>
                </div>
            `;
        }

        // Delete content
        function deleteContent(contentType, category, index) {
            if (confirm('Are you sure you want to delete this item?')) {
                if (contentType === 'events') {
                    eventsData[category].splice(index, 1);
                    displayEvents();
                } else {
                    lessonsData[category].splice(index, 1);
                    displayLessons();
                }
            }
        }

        // Export data
        function exportData(type) {
            const data = type === 'events' ? eventsData : lessonsData;
            console.log(`Exporting ${type} data:`, data);
            
            // Ensure data structure is correct
            if (type === 'events' && (!data.upcoming || !data.past)) {
                console.error('Events data structure is incorrect');
                alert('Error: Events data structure is incorrect');
                return;
            }
            if (type === 'lessons' && (!data.upcoming || !data.coming_soon)) {
                console.error('Lessons data structure is incorrect');
                alert('Error: Lessons data structure is incorrect');
                return;
            }
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `${type}-data.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log(`Successfully exported ${type} data`);
            alert(`${type.charAt(0).toUpperCase() + type.slice(1)} data exported successfully! Check your Downloads folder for ${type}-data.json`);
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
